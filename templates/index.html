<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>IATI Data Store CSV Query Builder (Alpha Version)</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="static/css/custom.css" type="text/css" rel="stylesheet">
    <link href="static/css/chosen.css" type="text/css" rel="stylesheet">
  </head>
  <body dir="ltr">
    <div class="container">
      <div class="header row">
        <div class="col">
          <h1 dir="ltr">
            IATI Data Store CSV Query Builder
            <sup><span class="badge badge-warning">Alpha</span></sup>
          </h1>
          <p>Please read the <a href="http://datastore.iatistandard.org/docs/user-guide/">user guide</a></p>
          <p>The IATI Query Builder allows you to build common queries to obtain data from the <a href="http://datastore.iatistandard.org/docs/">IATI Datastore</a> in CSV format.</p>
          <p>You may create queries based on who is reporting the information, where the activity is happening, and the sector that the activity occurs in. This may then be configured to show individual activities, transactions or budgets.</p>
        </div>
      </div><!-- end class="header" -->

      <div class="query-builder">
        <div class="row"><!-- result -->
          {% if api_link %}
            <div class="alert alert-success" role="alert">
              <strong>Your link:</strong> <a href="{{ api_link }}">{{ api_link|escape }}</a>
            </div>

            {% if notice_message %}
              <div class="alert alert-warning" role="alert">
                <strong>Warning:</strong> {{ notice_message }}
              </div>
            {% endif %}

          {% elseif error_message %}
            <div class="alert alert-danger" role="alert">
              <strong>Error:</strong> {{ error_message }}
            </div>
          {% endif %}
        </div>

        <form action="index.php" method="post" target="_self" onsubmit="">

          <h2>How would you like to view this information?</h2>
          <p>These options allow you to configure the way in which your data is disaggregated, making different sorts of analysis possible.</p>

          <div class="form-row">
            <div class="col">
              <label for="entry_1689841214">
                <div>Choose format
                  <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                </div>
              </label>
              <ul>
                <li>
                  <label>
                    <input type="radio" name="entry.1085079344" value="activity" id="group_1085079344_1" aria-label="Activity"
                    {% if not dataset or (dataset and dataset == "activity") %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>One activity per row</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Each row contains a unique activity. Financial information is aggregated. Budget information is excluded. Other potentially repeating fields (such as sectors) are reported in a single cell, delimited by semi-colons.">More info.</a>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="radio" name="entry.1085079344" value="transaction" id="group_1085079344_2" aria-label="Transaction"
                    {% if dataset and dataset == "transaction" %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>One transaction per row</span>
                    <a href="#" class="explaination-text" data-html="true" data-toggle="tooltip" title="Each row contains a unique financial transaction. The parent activity identifier and other activity-level fields are repeated for each transaction.<br/>If you are looking to analyse activity finances by year you need to select “Transactions” and calculate the year from the transaction date.">More info.</a>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="radio" name="entry.1085079344" value="budget" id="group_1085079344_3" aria-label="Budget"
                    {% if dataset and dataset == "budget" %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>One budget per row</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Each row contains a budget-period entry. Transaction data is not included. The parent activity identifier and other activity-level fields are repeated for each budget line.">More info.</a>
                  </label>
                </li>
              </ul>
            </div>

            <div class="col">
              <label for="entry_1948547450">
                <div>Repeat rows?
                  <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                </div>
              </label>
              <ul>
                <li>
                  <label>
                    <input type="radio" name="entry.71167035" value="summary" id="group_71167035_1" aria-label="Summary"
                    {% if not format or (format and format == "summary") %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>No</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Information is not disaggregated, leading to repeated rows.">More info.</a>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="radio" name="entry.71167035" value="by_sector" id="group_71167035_2" aria-label="By Sector"
                    {% if format and format == "by_sector" %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>Multi-sector expansion</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Each Activity, Transaction or Budget row is repeated for each separate Sector reported. The corresponding percentage for the sector split is reported in a separate column. This allows you to easily add arithmetic to your spreadsheet to calculate values proportionately.">More info.</a>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="radio" name="entry.71167035" value="by_country" id="group_71167035_3" aria-label="By Country"
                    {% if format and format == "by_country" %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>Multi-country expansion</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Each Activity, Transaction or Budget row is repeated for each separate Country reported. The corresponding percentage for the sector split is reported in a separate column. This allows you to easily add arithmetic to your spreadsheet to calculate values proportionately.">More info.</a>
                  </label>
                </li>
              </ul>
            </div>

            <div class="col">
              <label for="entry_1414120858">
                <div>Choose sample size
                  <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                </div>
              </label>
              <ul>
                <li>
                  <label>
                    <input type="radio" name="entry.1352830161" value="50 rows" id="group_1352830161_1" aria-label="50 rows"
                    {% if not size or (size and size == "50 rows") %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>50 rows</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="Preview your selection by viewing only the first 50 rows of data.">More info.</a>
                  </label>
                </li>
                <li>
                  <label>
                    <input type="radio" name="entry.1352830161" value="Entire selection" id="group_1352830161_2" aria-label="Entire selection"
                    {% if size and size == "stream=True" %}
                      checked="checked"
                    {% endif %}
                    />
                    <span>Entire selection</span>
                    <a href="#" class="explaination-text" data-toggle="tooltip" title="View all of the data matching your query.">More info.</a>
                    <p class="explaination-text"><strong>WARNING:</strong> Depending on the query, this may cause the query to take a long time to return your data.</p>
                  </label>
                </li>
              </ul>
            </div>
          </div>

          <h2>What information are you looking for?</h2>

          <p>These options let you filter the information you are looking for. Additional filters <a href="http://datastore.iatistandard.org/docs/api/#filtering">are available</a> by querying the Datastore manually.</p>

          <div class="row form-group">
            <label for="entry_1922375458">
              <div>
                Select reporting organisation (eg UK DFID = GB-GOV-1)
                <a href="#" class="explaination-text" data-toggle="tooltip" title="The reporting organisation is the publisher of the IATI data. You would choose this filter to analyse a particular donor or agency's data. This might typically be used in conjunction with a country and/or a sector.">More info.</a>
              </div>
              <div dir="ltr"></div>
            </label>
            <div class="clearfix"></div>
            <select data-placeholder="Choose a reporting organisation..." multiple class="chosen-select form-control" id="entry_1922375458[]" name="entry.1922375458[]">
              {{ include('include/reporting_org.html') }}
            </select>
            <p class="explaination-text"><strong>WARNING:</strong> The Datastore contains activities reported by both primary and secondary sources. A secondary source, such as the UNOCHA Financial Tracking Service (FTS), reports data it holds about other agencies’ activities. An agency may well report activities to both IATI and FTS, who in turn reports the same activities to IATI.</p>
          </div>

          <div class="row form-group">
            <label for="entry_18398991">
              <div>
                Select type of reporting organisation (eg. INGO = 21)
                <a href="#" class="explaination-text" data-toggle="tooltip" title="This allows you to filter by the type of organisation. To access data on NGOs only you would select International NGO and/or National NGO and/or Regional NGO.">More info.</a>
              </div>
            </label>
            <div class="clearfix"></div>
            <select data-placeholder="Choose a reporting organisation type..." multiple class="chosen-select form-control" id="entry_18398991[]" name="entry.18398991[]">
              {{ include('include/reporting_org_type.html') }}
            </select>
          </div>

          <div class="row form-group">
            <label for="entry_1954968791">
              <div>
                Select sector (eg Basic Health Care = 12220)
                <a href="#" class="explaination-text" data-toggle="tooltip" title="Choose the sector or sectors you are looking for.">More info.</a>
              </div>
            </label>
            <div class="clearfix"></div>
            <select data-placeholder="Choose a sector..." multiple class="chosen-select form-control" id="entry_1954968791[]" name="entry.1954968791[]">
              {{ include('include/sector.html') }}
            </select>
            <p class="explaination-text">For more detail of what the sectors are, see the <a href="http://iatistandard.org/202/codelists/Sector">DAC 5 Digit Sector</a> codelist.</p>
          </div>

          <div class="row form-group">
            <fieldset>
              <legend>Select EITHER a country OR a region</legend>
              <p class="explaination-text">Choosing a Region AND a Country will not return data as most publishers report to either a Country or a Region.</p>
              <div class="errorbox-good">
                <div dir="ltr">
                  <div>
                    <label for="entry_605980212">
                      <div>
                        Select recipient country
                        <a href="#" class="explaination-text" data-toggle="tooltip" title="Choose the recipient country or countries you are looking for.">More info.</a>
                      </div>
                    </label>
                    <div class="clearfix"></div>
                    <select data-placeholder="Choose a country..." multiple class="chosen-select form-control" id="entry_605980212[]" name="entry.605980212[]">
                      {{ include('include/country.html') }}
                    </select>
                  </div>
                </div>
              </div>
              <div class="errorbox-good">
                <div dir="ltr">
                  <div>
                    <label for="entry_1179181326">
                      <div>
                        Select region (eg South Asia = 679)
                        <a href="#" class="explaination-text" data-toggle="tooltip" title="Selecting a region will return activities that publishers have been unable to allocate to specific countries.">More info.</a>
                      </div>
                    </label>
                    <div class="clearfix"></div>
                    <select data-placeholder="Choose a region..." multiple class="chosen-select form-control" id="entry_1179181326[]" name="entry.1179181326[]">
                      {{ include('include/region.html') }}
                    </select>
                    <p class="explaination-text"><strong>NOTE:</strong> Information may be filtered based on the <a href="http://iatistandard.org/202/codelists/Region/">OECD DAC recipient codes</a>.</p>
                    <p class="explaination-text"><strong>WARNING:</strong> Regions do not automatically contain the countries they are made up of.</p>
                  </div>
                </div>
              </div>
            </fieldset>
          </div>

          <div class="form-row">
            <div class="col">
              <button class="btn btn-primary" type="submit">Build Query</button>
              <button class="btn btn-secondary" type="reset">Reset</button>
            </div>
          </div>

        </form>

      </div><!-- end class="query-builder"-->


      <div class="row footer">
        <div class="col">
          <p>IATI Query Builder is free software licenced under the GNU General Public License.<br/>
          <ul>
            <li><a href="https://github.com/IATI/IATI-Query-Builder" target="_blank" rel="noopener noreferrer nofollow">IATI Query Builder on GitHub</a></li>
            <li>Please report problems to our <a href="https://github.com/IATI/IATI-Query-Builder/issues" target="_blank" rel="noopener noreferrer nofollow">issues list</a>.</li>
            <li>Datastore documentation: <a href="http://datastore.iatistandard.org/" target="_blank" rel="noopener noreferrer">http://datastore.iatistandard.org</a></li>
          </ul>
          </p>
        </div>
      </div><!-- end class="footer"-->


    </div><!-- end class="container"-->

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="static/js/chosen.jquery.js" type="text/javascript"></script>
    <script>
      $(".chosen-select").chosen()
    </script>
    <script>
      $(document).ready(function(){
          $('[data-toggle="tooltip"]').tooltip();
      });
    </script>
  </body>
</html>
